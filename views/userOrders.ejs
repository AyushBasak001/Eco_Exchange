<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Orders | Eco-Exchange</title>
    <link rel="stylesheet" href="/styles/main.css">
    <link rel="stylesheet" href="/styles/userOrders.css">
</head>

<body>

<!-- ================= HEADER ================= -->
<header class="orders-header">
    <div class="container">
        <h1 class="orders-title">My Orders</h1>
        <p class="orders-subtitle">
            Track your purchases and manage your sales
        </p>
    </div>
</header>

<main class="orders-section">
    <div class="container">

        <!-- ================= BOUGHT ORDERS ================= -->
        <section class="orders-block">
            <h2 class="section-heading">Bought Orders</h2>

            <% if (boughtOrders.length === 0) { %>
                <p class="empty-state">No orders placed yet.</p>
            <% } %>

            <% boughtOrders.forEach(order => { %>
                <div class="order-card">

                    <div class="order-header">
                        <h3>Order #<%= order.id %></h3>
                        <span class="order-status <%= order.order_status.toLowerCase() %>">
                            <%= order.order_status %>
                        </span>
                    </div>

                    <div class="order-meta">
                        <p>Total: <strong>₹ <%= order.total_amount %></strong></p>
                        <p>Date: <%= order.created_at %></p>
                    </div>

                    <ul class="order-items">
                        <% order.items.forEach(item => { %>
                            <li>
                                <span><%= item.product_title %></span>
                                <span>
                                    × <%= item.quantity %>
                                    (₹ <%= item.price_at_purchase %>)
                                </span>
                            </li>
                        <% }) %>
                    </ul>

                    <% if (order.order_status !== 'COMPLETED' && order.order_status !== 'CANCELLED') { %>
                        <form class="order-action-form"
                              action="/user/orders/<%= order.id %>/cancel"
                              method="POST">
                            <button class="btn danger" type="submit">
                                Cancel Order
                            </button>
                        </form>
                    <% } %>

                </div>
            <% }) %>
        </section>

        <!-- ================= SOLD ORDERS ================= -->
        <section class="orders-block">
            <h2 class="section-heading">Sold Orders</h2>

            <% if (soldOrders.length === 0) { %>
                <p class="empty-state">No products sold yet.</p>
            <% } %>

            <% soldOrders.forEach(order => { %>
                <div class="order-card">

                    <div class="order-header">
                        <h3>Order #<%= order.id %></h3>
                        <span class="order-status <%= order.order_status.toLowerCase() %>">
                            <%= order.order_status %>
                        </span>
                    </div>

                    <div class="order-meta">
                        <p>Total: <strong>₹ <%= order.total_amount %></strong></p>
                        <p>Date: <%= order.created_at %></p>
                    </div>

                    <ul class="order-items">
                        <% order.items.forEach(item => { %>
                            <li>
                                <span><%= item.product_title %></span>
                                <span>
                                    × <%= item.quantity %>
                                    (₹ <%= item.price_at_purchase %>)
                                </span>
                            </li>
                        <% }) %>
                    </ul>

                    <% if (order.order_status !== 'COMPLETED' && order.order_status !== 'CANCELLED') { %>

                        <% if (order.order_status === 'PLACED') { %>
                            <form class="order-action-form"
                                  action="/user/orders/<%= order.id %>/confirm"
                                  method="POST">
                                <button class="btn success" type="submit">
                                    Confirm Order
                                </button>
                            </form>
                        <% } %>

                        <form class="order-action-form"
                              action="/user/orders/<%= order.id %>/cancel"
                              method="POST">
                            <button class="btn danger" type="submit">
                                Cancel Order
                            </button>
                        </form>

                    <% } %>

                </div>
            <% }) %>
        </section>

        <div class="orders-footer">
            <a class="back-link" href="/user">← Back to User Dashboard</a>
        </div>

    </div>
</main>

</body>
</html>
