<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>My Orders | Eco-Exchange</title>
</head>

<body>

<h1>My Orders</h1>

<!-- ================= BOUGHT ORDERS ================= -->
<h2>Bought Orders</h2>

<% if (boughtOrders.length === 0) { %>
    <p>No orders placed yet.</p>
<% } %>

<% boughtOrders.forEach(order => { %>
    <div class="order-card">
        <h3>Order #<%= order.id %></h3>
        <p>Status: <%= order.order_status %></p>
        <p>Total: ₹ <%= order.total_amount %></p>
        <p>Date: <%= order.created_at %></p>

        <ul>
            <% order.items.forEach(item => { %>
                <li>
                    <%= item.product_title %> × <%= item.quantity %>
                    (₹ <%= item.price_at_purchase %>)
                </li>
            <% }) %>
        </ul>

        <% if (order.order_status !== 'COMPLETED' && order.order_status !== 'CANCELLED') { %>
            <form action="/user/orders/<%= order.id %>/cancel" method="POST">
                <button type="submit">Cancel Order</button>
            </form>
        <% } %>
    </div>
<% }) %>


<hr>

<!-- ================= SOLD ORDERS ================= -->
<h2>Sold Orders</h2>

<% if (soldOrders.length === 0) { %>
    <p>No products sold yet.</p>
<% } %>

<% soldOrders.forEach(order => { %>
    <div class="order-card">
        <h3>Order #<%= order.id %></h3>
        <p>Status: <%= order.order_status %></p>
        <p>Total: ₹ <%= order.total_amount %></p>
        <p>Date: <%= order.created_at %></p>

        <ul>
            <% order.items.forEach(item => { %>
                <li>
                    <%= item.product_title %> × <%= item.quantity %>
                    (₹ <%= item.price_at_purchase %>)
                </li>
            <% }) %>
        </ul>

        <% if (order.order_status !== 'COMPLETED' && order.order_status !== 'CANCELLED') { %>

            <!-- Confirm Order (seller only) -->
            <% if (order.order_status === 'PLACED') { %>
                <form action="/user/orders/<%= order.id %>/confirm" method="POST">
                    <button type="submit">Confirm Order</button>
                </form>
            <% } %>

            <!-- Cancel Order -->
            <form action="/user/orders/<%= order.id %>/cancel" method="POST">
                <button type="submit">Cancel Order</button>
            </form>

        <% } %>
    </div>
<% }) %>

<br>
<a href="/user">← Back to User Dashboard</a>

</body>
</html>
