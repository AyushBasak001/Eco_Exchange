<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sell Product | Eco-Exchange</title>
</head>

<body>

<section>
    <h2>My Products</h2>

    <!-- ================= ACTIVE PRODUCTS ================= -->
    <h3>Active Products</h3>

    <% const activeProducts = products.filter(p =>
        p.status !== 'REMOVED' && p.quantity_available > 0
    ); %>

    <% if (activeProducts.length === 0) { %>
        <p>No active products.</p>
    <% } %>

    <% activeProducts.forEach(p => { %>
        <div class="product-row">
            <p><strong><%= p.title %></strong></p>
            <p>Status: <%= p.status %></p>
            <p>Qty: <%= p.quantity_available %></p>

            <!-- Restock -->
            <form action="/user/sell/<%= p.id %>/restock" method="POST">
                <input type="number" name="quantity" min="1" required>
                <button type="submit">Add Stock</button>
            </form>

            <!-- Remove -->
            <form action="/user/sell/<%= p.id %>/remove" method="POST">
                <button type="submit">Remove</button>
            </form>
        </div>
    <% }) %>


    <!-- ================= OUT OF STOCK ================= -->
    <h3>Out of Stock</h3>

    <% const outOfStockProducts = products.filter(p =>
        p.status !== 'REMOVED' && p.quantity_available === 0
    ); %>

    <% if (outOfStockProducts.length === 0) { %>
        <p>No out-of-stock products.</p>
    <% } %>

    <% outOfStockProducts.forEach(p => { %>
        <div class="product-row">
            <p><strong><%= p.title %></strong></p>
            <p>Status: <%= p.status %></p>
            <p>Qty: 0</p>

            <!-- Restock -->
            <form action="/user/sell/<%= p.id %>/restock" method="POST">
                <input type="number" name="quantity" min="1" required>
                <button type="submit">Restock</button>
            </form>

            <!-- Remove -->
            <form action="/user/sell/<%= p.id %>/remove" method="POST">
                <button type="submit">Remove</button>
            </form>
        </div>
    <% }) %>


    <!-- ================= REMOVED PRODUCTS ================= -->
    <h3>Removed Products</h3>

    <% const removedProducts = products.filter(p => p.status === 'REMOVED'); %>

    <% if (removedProducts.length === 0) { %>
        <p>No removed products.</p>
    <% } %>

    <% removedProducts.forEach(p => { %>
        <div class="product-row">
            <p><strong><%= p.title %></strong></p>
            <p>Status: REMOVED</p>
        </div>
    <% }) %>

</section>

<h2>Sell a Product</h2>

<form action="/user/sell/new" method="POST">

    <label>Title</label>
    <input type="text" name="title" required>

    <label>Description</label>
    <textarea name="description"></textarea>

    <label>Category</label>
    <select name="category_id" required>
        <option value="">Select Category</option>
        <% categories.forEach(c => { %>
            <option value="<%= c.id %>"><%= c.name %></option>
        <% }) %>
    </select>

    <label>Waste Type</label>
    <select name="waste_type_id" required>
        <option value="">Select Waste Type</option>
        <% wasteTypes.forEach(w => { %>
            <option value="<%= w.id %>"><%= w.name %></option>
        <% }) %>
    </select>

    <label>Price (₹)</label>
    <input type="number" name="price" step="0.01" min="0" required>

    <label>Quantity</label>
    <input type="number" name="quantity_available" min="1" required>

    <button type="submit">Submit</button>
</form>

<a href="/user">← Back to User Dashboard</a>

</body>
</html>